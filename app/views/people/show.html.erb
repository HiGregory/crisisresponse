<p id="notice"><%= notice %></p>

<h1><%= @name.titleize %></h1>

<table>
  <thead>
    <td>go_id</td>
    <td>reported_on_date</td>
    <td>reported_on_time</td>
    <td>report_year</td>
    <td>report_number</td>
    <td>chbk_biologically_induced</td>
    <td>chbk_medically_induced</td>
    <td>chbk_chemically_induced</td>
    <td>chbk_unknown_crisis_nature</td>
    <td>chbk_neglect_self_care</td>
    <td>chbk_disorganize_communication</td>
    <td>chbk_disoriented_confused</td>
    <td>chbk_disorderly_disruptive</td>
    <td>chbk_unusual_fright_scared</td>
    <td>chbk_belligerent_uncooperative</td>
    <td>chbk_hopeless_depressed</td>
    <td>chbk_bizarre_unusual_behavior</td>
    <td>chbk_suicide_threat_attempt</td>
    <td>chbk_mania</td>
    <td>chbk_out_of_touch_reality</td>
    <td>chbk_halluc_delusion</td>
    <td>chbk_wpn_knife</td>
    <td>chbk_wpn_gun</td>
    <td>chbk_wpn_oth</td>
    <td>chbk_verbalization</td>
    <td>chbk_dispo_chronic</td>
    <td>chbk_dispo_treatment_referral</td>
    <td>chbk_dispo_resource_declined</td>
    <td>chbk_dispo_mobile_crisis_team</td>
    <td>chbk_dispo_grat</td>
    <td>chbk_dispo_shelter</td>
    <td>chbk_dispo_no_action_poss_necc</td>
    <td>chbk_dispo_casemanager_notice</td>
    <td>chbk_dispo_dmhp_refer</td>
    <td>chbk_dispo_crisis_clinic</td>
    <td>chbk_dispo_emergent_ita</td>
    <td>chbk_dsipo_voluntary_commit</td>
    <td>chbk_dispo_arrested</td>
    <td>crisis_contacted_vet_yn_unk</td>
    <td>weapon_yn_dk</td>
    <td>threaten_violence_yn_dk</td>
    <td>chbk_excited_delirium</td>
  </thead>
  <tbody>
    <%= render @events %>
  </tbody>
</table>


<div class="ct-chart"></div>

<% chartFields = [
  "chbk_biologically_induced",
  "chbk_medically_induced",
  "chbk_chemically_induced",
  "chbk_unknown_crisis_nature",
  "chbk_neglect_self_care",
  "chbk_disorganize_communication",
  "chbk_disoriented_confused",
  "chbk_disorderly_disruptive",
  "chbk_unusual_fright_scared",
  "chbk_belligerent_uncooperative",
  "chbk_hopeless_depressed",
  "chbk_bizarre_unusual_behavior",
  "chbk_suicide_threat_attempt",
  "chbk_mania",
  "chbk_out_of_touch_reality",
  "chbk_halluc_delusion",
  "chbk_wpn_knife",
  "chbk_wpn_gun",
  "chbk_wpn_oth",
  "chbk_verbalization",
  "chbk_dispo_chronic",
  "chbk_dispo_treatment_referral",
  "chbk_dispo_resource_declined",
  "chbk_dispo_mobile_crisis_team",
  "chbk_dispo_grat",
  "chbk_dispo_shelter",
  "chbk_dispo_no_action_poss_necc",
  "chbk_dispo_casemanager_notice",
  "chbk_dispo_dmhp_refer",
  "chbk_dispo_crisis_clinic",
  "chbk_dispo_emergent_ita",
  "chbk_dsipo_voluntary_commit",
  "chbk_dispo_arrested",
  "weapon_yn_dk",
  "threaten_violence_yn_dk",
  "chbk_excited_delirium"
  ]

series = chartFields.map do |field|
  @events.count { |e| e.send(field).downcase == 'x' }.to_f / @events.count
end
%>

<script>
var data = {
  // A labels array that can contain any sort of values
  labels: <%= chartFields.inspect.html_safe %>,
    // Our series array that contains series objects or in this case series data arrays
    series: [
      <%= series.inspect.html_safe %>
    ]

};


// As options we currently only set a static size of 300x200 px. We can also omit this and use aspect ratio containers
// as you saw in the previous example
var options = {
  axisY: {
    offset: 200,
  },
  axisX: {
    scaleMinSpace: 100,
    position: 'start',
    labelInterpolationFnc: function(value, index, all) {
      return String(value * 100) + "%";
    },
  },
  height: 1000,
  width: 500,
  horizontalBars: true
};

// Create a new line chart object where as first parameter we pass in a selector
// that is resolving to our chart container element. The Second parameter
// is the actual data object. As a third parameter we pass in our custom options.
new Chartist.Bar('.ct-chart', data, options);
</script>

<%= link_to 'Back', people_path %>
